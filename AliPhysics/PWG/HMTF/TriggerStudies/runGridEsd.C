// LHC15f
//TString dataDir = "/alice/data/2015/LHC15f";
//TString dataPattern = "/pass2/*/AliESDs.root";
//TString workingDir = "lhc15f";
//Int_t nRuns = 56;
//Int_t runList[] = {
//    226500, 226495, 226483, 226476, 226472, 226468, 226466, 226452, 226445, 226444, 
//    226225, 226220, 226170, 226062, 225768, 225766, 225763, 225762, 225757, 225753, 
//    225719, 225717, 225716, 225710, 225709, 225708, 225707, 225705, 225587, 225586, 
//    225582, 225580, 225579, 225578, 225576, 225322, 225315, 225314, 225313, 225310, 
//    225309, 225307, 225305, 225106, 225052, 225051, 225050, 225043, 225041, 225037, 
//    225035, 225031, 225026, 225016, 225011, 225000
//};


// LHC15f
//TString dataDir = "/alice/data/2015/LHC15f";
// TString dataPattern = "/muon_calo_pass1/AOD/*/AliAOD.root";
// TString dataPattern = "/pass2/*/AliESDs.root";
//TString workingDir = "lhc15f";
//Int_t nRuns = 56;
//Int_t runList[] = {226500, 226495, 226483, 226476, 226472, 226468, 226466, 226452, 226445, 226444, 226225, 226220, 226170, 226062, 225768, 225766, 225763, 225762, 225757, 225753, 225719, 225717, 225716, 225710, 225709, 225708, 225707, 225705, 225587, 225586, 225582, 225580, 225579, 225578, 225576, 225322, 225315, 225314, 225313, 225310, 225309, 225307, 225305, 225106, 225052, 225051, 225050, 225043, 225041, 225037, 225035, 225031, 225026, 225016, 225011, 225000};

// LHC15f
// TString dataDir = "/alice/data/2015/LHC15f";
//  TString dataPattern = "/muon_calo_pass2/*/AliESDs.root";
// TString workingDir = "lhc15f";
// Int_t nRuns = 37;
// Int_t runList[] = {226062, 225768, 225766, 225763, 225762, 225757, 225753, 225719, 225717, 225716, 225710, 225709, 225708, 225707, 225705, 225587, 225586, 225582, 225580, 225579, 225578, 225576, 225322, 225315, 225310, 225307, 225305, 225106, 225052, 225051, 225050, 225043, 225041, 225037, 225035, 225031, 225026};

// LHC15h
//TString dataDir = "/alice/data/2015/LHC15h";
//TString dataPattern = "/muon_calo_pass1/*/AliESDs.root";
//TString workingDir = "lhc15h";
//Int_t nRuns = 64;
//Int_t runList[] = {
//    232914, 232916, 232977, 232986, 232993, 232995, 233020, 233059, 233061, 233093, 
//    233116, 233120, 233144, 233169, 233172, 233217, 233232, 233233, 233239, 233242, 
//    233361, 233463, 233465, 233472, 233614, 233621, 233623, 233627, 233678, 233686, 
//    233692, 233696, 233697, 233698, 233700, 233702, 233707, 233708, 233716, 233718, 
//    233719, 233720, 233721, 233743, 233799, 233828, 233830, 233837, 233858, 233912, 
//    233969, 233971, 233972, 233973, 233974, 233975, 233976, 233977, 233978, 234031, 
//    234039, 234048, 234049, 234050
//};


// LHC15i
//TString dataDir = "/alice/data/2015/LHC15i";
//TString dataPattern = "/muon_calo_pass2/*/AliESDs.root";
//TString workingDir = "lhc15i";
//Int_t nRuns = 126;
/*Int_t runList[] = {
    235196, 235201, 235203, 235204, 235226, 235242, 235245, 235344, 235345, 235346, 
    235347, 235356, 235362, 235364, 235380, 235383, 235423, 235432, 235435, 235436, 
    235443, 235450, 235454, 235457, 235459, 235462, 235547, 235573, 235683, 235684, 
    235685, 235687, 235694, 235710, 235714, 235721, 235759, 235811, 235813, 235839, 
    235841, 235886, 235888, 235889, 235890, 235891, 235892, 235893, 235895, 235896, 
    235897, 235898, 236062, 236137, 236138, 236150, 236151, 236153, 236158, 236159, 
    236161, 236163, 236164, 236203, 236204, 236222, 236227, 236234, 236238, 236240, 
    236242, 236244, 236246, 236248, 236281, 236284, 236285, 236331, 236334, 236337, 
    236348, 236349, 236352, 236353, 236354, 236356, 236357, 236359, 236360, 236386, 
    236389, 236393, 236395, 236397, 236441, 236443, 236444, 236446, 236453, 236459, 
    236462, 236541, 236554, 236556, 236558, 236562, 236563, 236564, 236565, 236569, 
    236575, 236813, 236814, 236815, 236816, 236818, 236821, 236822, 236824, 236835, 
    236848, 236850, 236860, 236862, 236863, 236866
    };*/


//LHC15j
// TString dataDir = "/alice/data/2015/LHC15j";
// TString dataPattern = "/muon_calo_pass2/*/AliESDs.root";
// TString workingDir = "lhc15j_testITSsaMatch";
//Int_t nRuns = 155;
//Int_t runList[] = {
//    236892, 236893, 236965, 236968, 236969, 236972, 236973, 237001, 237029, 237049, 
//    237051, 237056, 237061, 237104, 237111, 237112, 237115, 237174, 237180, 237244, 
//    237245, 237251, 237253, 237255, 237259, 237286, 237288, 237289, 237291, 237330, 
//    237335, 237342, 237350, 237356, 237364, 237368, 237372, 237391, 237394, 237396, 
//    237397, 237400, 237401, 237406, 237408, 237409, 237502, 237504, 237505, 237507, 
//    237512, 237515, 237645, 237670, 237671, 237675, 237676, 237678, 237681, 237684, 
//    237691, 237698, 237699, 237705, 237706, 237707, 237708, 237710, 237711, 237713, 
//    237765, 237768, 237777, 237779, 237780, 237782, 237787, 237789, 237790, 237791, 
//    237793, 237795, 237796, 237806, 237842, 237844, 237845, 237847, 237945, 237948, 
//    237969, 237978, 237982, 237983, 238073, 238091, 238097, 238129, 238131, 238132, 
//    238133, 238136, 238139, 238140, 238142, 238144, 238145, 238147, 238148, 238154, 
//    238159, 238160, 238164, 238170, 238176, 238179, 238184, 238185, 238187, 238395, 
//    238396, 238398, 238399, 238400, 238429, 238431, 238432, 238451, 238454, 238455, 
//    238456, 238457, 238458, 238459, 238460, 238466, 238468, 238469, 238470, 238472, 
//    238474, 238570, 238576, 238578, 238579, 238583, 238587, 238594, 238598, 238604, 
//    238606, 238607, 238610, 238614, 238621
//};
// Int_t nRuns = 25;
// Int_t runList[] = {
//   237029, 237645, 237670, 237671, 237675, 237676, 237678, 237707, 237708, 237710, 237711, 237713, 237765, 237777, 237779, 237780, 237782, 237795, 237945, 237948, 237969, 237978, 237982, 237983, 238583,
// };
// LHC15k
//TString dataDir = "/alice/data/2015/LHC15k";
//TString dataPattern = "/muon_calo_pass1/*/AliESDs.root";
//TString workingDir = "lhc15k";
//Int_t nRuns = 42;
//Int_t runList[] = {
//    238682, 238683, 238684, 238685, 238686, 238687, 238688, 238689, 238690, 238691, 
//    238692, 238693, 238694, 238890, 238895, 238896, 238938, 238939, 238940, 238941, 
//    238958, 238959, 238962, 238964, 238965, 238966, 239024, 239025, 239053, 239054, 
//    239057, 239058, 239061, 239062, 239066, 239067, 239109, 239110, 239116, 239141, 
//    239143, 239144
//};

// LHC15l
TString dataDir = "/alice/data/2015/LHC15l";
TString dataPattern = "/muon_calo_pass1/*/AliESDs.root";
TString workingDir = "lhc15l_testITSsaMatch";
Int_t nRuns = 18;
//Int_t runList[] = {
//      239319, 239324, 239518, 239519, 240069, 240165, 240183, 240194, 240196, 240201, 
//      240204, 240212, 240220, 240241, 240250, 240256, 240262, 240263, 240265, 240271, 
//      240274, 240293, 240303, 240312, 240376, 240380, 240381, 240382, 240385, 240392, 
//      240394, 240404, 240411, 240427, 240443, 240444, 240447, 240450, 240452, 240610, 
//      240612, 240845, 240854, 240860, 240864, 240872, 240874, 240875, 240880, 241001, 
//      241010, 241014, 241021, 241032, 241043, 241047, 241050, 241054, 241055, 241056, 
//      241057, 241062, 241069, 241075, 241141, 241144, 241152, 241176, 241187, 241196, 

//      241222, 241245, 241257, 241261, 241263, 241267, 241268, 241269, 241281, 241288, 
//      241295, 241296, 241354, 241360, 241361, 241393, 241396, 241407, 241412, 241526
//};
Int_t runList[] = {
  241141, 241144, 241152, 241176, 241187, 241196, 241222, 241245, 241257, 241261, 241263, 241267, 241268, 241269, 241281, 241288, 241295, 241296,
};
  
void runGridEsd(){
  gSystem->AddIncludePath("-I. -I$ALICE_ROOT/include -I$ALICE_PHYSICS/include");

  if (!TGrid::Connect("alien://")) return;

  AliAnalysisManager *mgr = new AliAnalysisManager("Analysis");
//  AliAODInputHandler* handler = new AliAODInputHandler();
  AliESDInputHandler* handler = new AliESDInputHandler();
  handler->SetReadFriends(kTRUE);
  mgr->SetInputEventHandler(handler);


  gROOT->LoadMacro("AliAnalysisTaskTest.cxx+g");
  AliAnalysisTaskTest *ana = new AliAnalysisTaskTest();
  mgr->AddTask(ana);
  AliAnalysisDataContainer *coutput1 = mgr->CreateContainer("events", TTree::Class(),AliAnalysisManager::kOutputContainer,"AnalysisResults.root");
  mgr->ConnectInput  (ana, 0, mgr->GetCommonInputContainer());
  mgr->ConnectOutput (ana, 1, coutput1);

  if (!mgr->InitAnalysis()) return;
  
  AliAnalysisAlien *plugin = new AliAnalysisAlien();
  plugin->SetRunMode("full");
  plugin->SetNtestFiles(2);
  plugin->SetAPIVersion("V1.1x");
  plugin->SetAliPhysicsVersion("vAN-20160501-1");
  plugin->SetGridDataDir(dataDir.Data());
  plugin->SetDataPattern(dataPattern.Data());
  plugin->SetGridWorkingDir(workingDir.Data());
  plugin->SetRunPrefix("000");
  for (Int_t i=0;i<nRuns;i++)  plugin->AddRunNumber(runList[i]);
  plugin->SetGridOutputDir("output");
  plugin->SetAnalysisSource("AliAnalysisTaskTest.cxx");
  plugin->SetAdditionalLibs("AliAnalysisTaskTest.h AliAnalysisTaskTest.cxx");
  plugin->SetNrunsPerMaster(1);
  plugin->SetSplitMaxInputFileNumber(300);
  plugin->SetMergeViaJDL();
  plugin->SetMaxMergeStages(1);
  plugin->SetOutputToRunNo(1);
  plugin->SetTTL(86400);
  
  mgr->SetGridHandler(plugin);
  mgr->PrintStatus();
  mgr->StartAnalysis("grid");
  //mgr->StartAnalysis("full");
 
//  TChain *chain = new TChain("esdTree");
//  for (Int_t i=1;i<=1;i++) chain->AddFile(Form("/data/esd/LHC12h/189616/AliESDs.%03i.root",i));
//  mgr->StartAnalysis("local",chain);
}
